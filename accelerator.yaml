accelerator:
  displayName: API Driven Microservices workflow
  description: Configure the path-to-production of an API-driven microservices application
  iconUrl: https://raw.githubusercontent.com/dektlong/dekt-images/80bfdbf23040731d16310e286e7d40b57e3b23d5/tanzu.png
  tags:
  - onlinestore-devops

  options:
  
  #devops supply chain
  
  - name: supplychain
    inputType: checkbox
    label: DevOps supply chain
    description: Generated configuration for the DevOps supply chain
    required: true
    dataType: [string]
    defaultValue:
      - tap
      - tbs
    choices:
      - value: k8s
        text: DIY with k8s resources
      - value: tap
        text: Tanzu Application Platform (kontinue)
      - value: tbs
        text: Build Service (kpack)
      - value: tas
        text: Tanzu Application Service (cloud foundry)
  
  - name: parentGit
    label: Parent git repo
    description: Parent Git URL for all microservices in this project
    defaultValue: https://github.com/dektlong/APIGridDemo
    required: true
  
  
  #API Grid
  
  - name: apiValidator
    inputType: checkbox
    label: API validation policy
    description: Policy to score and validate APIs spec and performance
    display: true
    dataType: [string]
    defaultValue:
      - project
      - internal
    choices:
      - value: project
        text: Project level access
      - value: internal
        text: Internal teams collabolartion 
      - value: external
        text: Extenral facing APIs
  
  - name: haCount
    label: Micro-gateway HA count
    description:  How many instances to deploy every Micro-gateway with 
    required: true
    defaultValue: "2"
  - name: ssoProvider
    label: Identity provider
    description: SSO OpenID identity provider
    inputType: select 
    defaultValue: openId
    required: true
    choices:
    - value: amazon
      text: Amazon
    - value: google
      text: Google
    - value: okta
      text: Okta (Auth0)
    - value: microsoft
      text: Microsoft
    - value: openId
      text: OpenID connect (generic)
  
  
  
  - name: apiScorecards
    description: URL for API Scorecards dashboard
    defaultValue: https://vmware.wavefront.com/u/xNrc03cJ7L?t=vmware
    display: true
  
  - name: subpath1
    label: Microservice 1 sub-path
    description: Sub-path within partent git for microservice1
    defaultValue: workloads/dekt4pets/backend
    display: true
  - name: subpath2
    label: Microservice 2 sub-path
    description: Sub-path within partent git for microservice2
    defaultValue: workloads/dekt4pets/frontend
    display: true
  - name: subPath3
    label: Microservice 3 sub-path
    description: Sub-path within partent git for microservice3
    defaultValue: sub-path3
  - name: subPath4
    label: Microservice 4 sub-path
    description: Sub-path within partent git for microservice4
    defaultValue: sub-path4
  - name: subPath5
    label: Microservice 5 sub-path
    description: Sub-path within partent git for microservice5
    defaultValue: sub-path5
  
  - name: deploymentDomain
    label: Initial deployment domain
    description: The initial deployment domain 
    display: true
    defaultValue: tanzu.dekt.io

engine:
  sources:
  #supplychain
  - includes: [ "supplychain/tap-kontinue/**" ]
    condition: "#supplychain.contains('tap')"
  - includes: [ "supplychain/vanila-k8s/**" ]
    condition: "#supplychain.contains('k8s')"
  - includes: [ "supplychain/tbs-kpack/**" ]
    condition: "#supplychain.contains('tbs')"
  - includes: [ "supplychain/tas-cf/**" ]
    condition: "#supplychain.contains('tas')"
  #api-grid
  - includes: [ "api-grid/validators/project-validator.yaml" ]
    condition: "#apiValidator.contains('project')"
  - includes: [ "api-grid/validators/internal-validator.yaml" ]
    condition: "#apiValidator.contains('internal')"
  - includes: [ "api-grid/validators/external-validator.yaml" ]
    condition: "#apiValidator.contains('external')"
     

  transformations:
  - type: ReplaceText
    substitutions:
    - text: app-name
      with: "#artifactId"
    - text: deployment-domain
      with: "#deploymentDomain"
    - text: sso-provider
      with: "#ssoProvider"
    - text: ha-count
      with: "#haCount"
    - text: parent-git
      with: "#parentGit"
    - text: subpath1
      with: "#subpath1"
    - text: subpath2
      with: "#subpath2"
    - text: api-scorecards
      with: "#apiScorecards"

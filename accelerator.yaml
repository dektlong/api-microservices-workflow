accelerator:
  displayName: API Driven Microservices workflow
  description: Configure the path-to-production of an API-driven microservices application
  iconUrl: https://raw.githubusercontent.com/dektlong/dekt-images/80bfdbf23040731d16310e286e7d40b57e3b23d5/tanzu.png
  tags:
  - onlinestore-devops

  options:
  - name: deploymentDomain
    label: Initial deployment domain
    description: The initial deployment domain 
    dataType: string
    inputType: text
    defaultValue: myproject.example.com
    required: true
  - name: apiValidator
    label: API validation policy
    description:  Policy to score and validate APIs spec and performance
    dataType: string
    required: true
    defaultValue: project
    inputType: select
    choices:
      project: Project level access 
      internal: Internal teams collabolartion 
      external: Extenral facing APIs
  - name: ssoProvider
    label: Identity provider
    description: SSO OpenID identity provider
    dataType: string
    inputType: select 
    defaultValue: internal
    required: true
    choices:
      amazon: Amazon
      google: Google
      okta: Okta (Auth0)
      microsoft: Microsoft
      internal: Internal
      openId: Custom OpenID connect
  - name: microGatewayHA
    label: Micro-Gateway HA setup
    description: HA setup for micro gateways deployment
    dataType: string
    inputType: select
    required: true
    defaultValue: 1
    choices:
      1: Testing 
      2: Integration  
      4: Production
  - name: apiPortal
    description: Add API Portal configuration  
    dataType: boolean
    defaultValue: false
    inputType: toggle
  - name: apiScorecards
    description: URL for API Scorecards dashboard
    dataType: string
    defaultValue: https://github.com/dektlong/_dekt4pets-demo
    inputType: text
  - name: microService1Git
    label: First microservice git
    description: Git URL for 1st microservice in this business workflow
    dataType: string
    inputType: text
    defaultValue: https://github.com/myuser/myrepo
    required: true
  - name: microService2Git
    label: Second microservice git
    description: Git URL for 2nd microservice in this business workflow
    dataType: string
    defaultValue: git2
    inputType: text
  - name: microService3Git
    label: Third microservice git
    description: Git URL for 3rd microservice in this business workflow
    dataType: string
    inputType: text
    defaultValue: git3
  - name: microService4Git
    label: Forth microservice git
    description: Git URL for 4th microservice in this business workflow
    dataType: string
    inputType: text
    defaultValue: git4
  - name: microService5Git
    label: Fifth microservice git
    description: Git URL for 5th microservice in this business workflow
    dataType: string
    inputType: text
    defaultValue: git5
  - name: microService1Name
    label: First microservice name
    dataType: string
    inputType: text
    defaultValue: dekt4pets-backend
  - name: microService2Name
    label: Second microservice git
    dataType: string
    inputType: text
    defaultValue: dekt4pets-frontend

engine:
  sources:
   - includes: ["**"]
     excludes: [ "accelerators/deployment/**" ]
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"
       - text: api-group1
         with: "#firstApiGroup"
       - text: api-group2
         with: "#secondApiGroup"
   - includes: [ "accelerators/deployment/app-simple.yaml" ]
     condition: "#appDeploymentType == 'k8s'"
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"
   - includes: [ "accelerators/deployment/app-observer.yaml" ]
     condition: "#appDeploymentType == 'k8sObserver'"
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"

  options:
  
engine:
  resources:
  - name: set-user-selections
    includes: ["**"]
    transformations:
      replace:
      - token: "{{appName}}"
        with: '#projectName'
      - token: "{{deploymentDomain}}"
        with: '#deploymentDomain'
      - token: "{{ssoProvider}}"
        with: '#ssoProvider'
      - token: "{{apiValidator}}"
        with: '#apiValidator'
      - token: "{{haCount}}"
        with: '#microGatewayHA'
      - token: "{{microService1Git}}"
        with: '#microService1Git'
      - token: "{{microService2Git}}"
        with: '#microService2Git'
      - token: "{{microService1Name}}"
        with: '#microService1Name'
      - token: "{{microService2Name}}"
        with: '#microService2Name'
      - token: "{{apiScorecards}}"
        with: '#apiScorecards'
    excludes: ["accelerator.yaml", "accelerators/api-grid/api-portal.yaml"]
  - name: include-api-portal
    includes: ["accelerators/api-grid/api-portal.yaml"]
    transformations:
      replace:
      - token: "{{deploymentDomain}}"
        with: '#deploymentDomain'
    condition: '#apiPortal'  
    
      

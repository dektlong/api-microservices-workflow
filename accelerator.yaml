accelerator:
  displayName: API Driven Microservices workflow
  description: Configure the path-to-production of an API-driven microservices application
  iconUrl: https://raw.githubusercontent.com/dektlong/dekt-images/80bfdbf23040731d16310e286e7d40b57e3b23d5/tanzu.png
  tags:
  - onlinestore-devops

  options:
  - name: deploymentDomain
    label: Initial deployment domain
    description: The initial deployment domain 
    dataType: string
    inputType: text
    defaultValue: myproject.example.com
    required: true
  - name: apiValidator
    label: API validation policy
    description:  Policy to score and validate APIs spec and performance
    dataType: string
    required: true
    defaultValue: project
    inputType: select
    choices:
      project: Project level access 
      internal: Internal teams collabolartion 
      external: Extenral facing APIs
  - name: gatewayHA
    label: Micro-gateway HA count
    description:  How many instances to deploy every Micro-gateway with 
    dataType: number
    required: true
    defaultValue: 2
    inputType: text
  - name: ssoProvider
    label: Identity provider
    description: SSO OpenID identity provider
    dataType: string
    inputType: select 
    defaultValue: openId
    required: true
    choices:
      amazon: Amazon
      google: Google
      okta: Okta (Auth0)
      microsoft: Microsoft
      openId: OpenID connect
  - name: apiScorecards
    description: URL for API Scorecards dashboard
    dataType: string
    defaultValue: https://vmware.wavefront.com/u/xNrc03cJ7L?t=vmware
    inputType: text
  - name: parentGit
    label: Parent git repo
    description: Parent Git URL for all microservices in this project
    dataType: string
    inputType: text
    defaultValue: https://github.com/dektlong/_dekt4pets-demo
    required: true
  - name: subPath1
    label: Microservice 1 sub-path
    description: Sub-path within partent git for microservice1
    dataType: string
    defaultValue: sub-path1
    inputType: text
  - name: subPath2
    label: Microservice 2 sub-path
    description: Sub-path within partent git for microservice2
    dataType: string
    defaultValue: sub-path2
    inputType: text
  - name: subPath3
    label: Microservice 3 sub-path
    description: Sub-path within partent git for microservice3
    dataType: string
    defaultValue: sub-path3
    inputType: text
  - name: subPath4
    label: Microservice 4 sub-path
    description: Sub-path within partent git for microservice4
    dataType: string
    defaultValue: sub-path4
    inputType: text
  - name: subPath5
    label: Microservice 5 sub-path
    description: Sub-path within partent git for microservice5
    dataType: string
    defaultValue: sub-path5
    inputType: text

engine:
  sources:
   - includes: ["**"]
     excludes: ["api-grid/validators/**"]
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"
       - text: deployment-domain
         with: "#deploymentDomain"
       - text: sso-provider
         with: "#ssoProvider"
       - text: api-validator
         with: "#apiValidator"
       - text: parent-git
         with: "#parentGit"
       - text: subpath1
         with: "#subPath1"
       - text: subpath2
         with: "#subPath2"
       - text: api-scorecards
         with: "#apiScorecards"
   - includes: [ "api-grid/validators/project-validator.yaml" ]
     condition: "#apiValidator == 'project'"
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"
   - includes: [ "api-grid/validators/internal-validator.yaml" ]
     condition: "#apiValidator == 'internal'"
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"
   - includes: [ "api-grid/validators/external-validator.yaml" ]
     condition: "#apiValidator == 'external'"
     transformations:
     - type: ReplaceText
       substitutions:
       - text: app-name
         with: "#artifactId"
      
